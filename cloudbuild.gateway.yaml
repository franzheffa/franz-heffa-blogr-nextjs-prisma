substitutions:
  _SERVICE: "agent-gateway"
  _REGION: "europe-west1"
  _ECHO_URL: "https://example.com"   # surcharg√© via --substitutions
steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build','-t','gcr.io/$PROJECT_ID/${_SERVICE}:$BUILD_ID','-f','Dockerfile.gateway','.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push','gcr.io/$PROJECT_ID/${_SERVICE}:$BUILD_ID']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args:
    [
      'run','deploy','${_SERVICE}',
      '--image','gcr.io/$PROJECT_ID/${_SERVICE}:$BUILD_ID',
      '--region','${_REGION}',
      '--platform','managed',
      '--allow-unauthenticated',
      '--set-env-vars','GOOGLE_CLOUD_PROJECT=$PROJECT_ID,VERTEX_LOCATION=${_REGION},GEMINI_MODEL=${_GEMINI_MODEL}',
      '--concurrency','20','--cpu','1','--memory','512Mi'
    ]
